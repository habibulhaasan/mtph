<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV to JSON Converter & Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .code-font {
            font-family: 'Fira Code', monospace;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }

        .drag-active {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4 text-slate-800">

    <div class="max-w-6xl w-full bg-white rounded-2xl shadow-xl overflow-hidden">
        
        <!-- Header -->
        <div class="bg-slate-900 text-white p-6 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fa-solid fa-file-csv text-green-400"></i>
                    <span>CSV <i class="fa-solid fa-arrow-right text-slate-500 text-sm mx-1"></i> JSON</span>
                </h1>
                <p class="text-slate-400 text-sm mt-1">Convert CSV and translate columns (English to Bangla).</p>
            </div>
            <button onclick="resetApp()" class="text-slate-400 hover:text-white transition-colors text-sm font-medium">
                <i class="fa-solid fa-rotate-right mr-1"></i> Reset
            </button>
        </div>

        <div class="flex flex-col lg:flex-row h-full">
            
            <!-- Left Side: Input -->
            <div class="w-full lg:w-2/5 p-6 border-b lg:border-b-0 lg:border-r border-slate-200 bg-slate-50 flex flex-col gap-6">
                
                <!-- Upload Area -->
                <div id="drop-zone" class="border-2 border-dashed border-slate-300 rounded-xl bg-white p-8 text-center transition-all duration-200 flex flex-col items-center justify-center h-48 group cursor-pointer hover:border-blue-400 hover:bg-slate-50 relative">
                    <input type="file" id="fileInput" accept=".csv" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <div class="bg-blue-100 text-blue-600 rounded-full p-4 mb-4 group-hover:scale-110 transition-transform">
                        <i class="fa-solid fa-cloud-arrow-up text-2xl"></i>
                    </div>
                    <h3 class="font-semibold text-lg text-slate-700">Click or Drag CSV here</h3>
                    <p class="text-slate-500 text-sm mt-1">Supports standard CSV files</p>
                </div>

                <!-- Progress Bar Area -->
                <div id="progressContainer" class="hidden bg-white p-4 rounded-xl border border-slate-200 shadow-sm transition-all duration-300">
                    <div class="flex justify-between text-xs font-semibold text-slate-600 mb-2">
                        <span id="progressLabel">Reading file...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Translation Tool (New) -->
                <div id="translationPanel" class="hidden bg-white p-5 rounded-xl border border-green-200 shadow-sm ring-1 ring-green-100">
                    <h3 class="font-bold text-green-700 mb-3 text-sm flex items-center gap-2">
                        <i class="fa-solid fa-language"></i> Translate Column (Eng to Bangla)
                    </h3>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-medium text-slate-500 mb-1 block">Select Column</label>
                            <select id="transColumn" class="w-full text-sm border-slate-300 rounded-md shadow-sm focus:border-green-500 focus:ring focus:ring-green-200 p-2 border bg-slate-50">
                                <option value="" disabled selected>-- Wait for CSV --</option>
                            </select>
                        </div>

                        <div>
                            <label class="text-xs font-medium text-slate-500 mb-1 block">Translation Mode</label>
                            <select id="transMode" class="w-full text-sm border-slate-300 rounded-md shadow-sm focus:border-green-500 focus:ring focus:ring-green-200 p-2 border bg-slate-50">
                                <option value="date">Dates (e.g. 12 Jan 2024 -> ১২ জানু ২০২৪)</option>
                                <option value="number">Numbers Only (123 -> ১২৩)</option>
                                <option value="names">Days/Months (Monday -> সোমবার)</option>
                            </select>
                        </div>

                        <button onclick="applyTranslation()" class="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-md text-sm font-semibold transition-colors shadow-sm">
                            Apply Translation
                        </button>
                    </div>
                </div>

                <!-- Basic Options -->
                <div class="bg-white p-5 rounded-xl border border-slate-200 shadow-sm">
                    <h3 class="font-semibold text-slate-700 mb-3 text-sm uppercase tracking-wide">CSV Options</h3>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <label class="text-sm text-slate-600">Delimiter</label>
                            <select id="delimiter" class="text-sm border-slate-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-1 border bg-slate-50">
                                <option value="auto">Auto-Detect</option>
                                <option value=",">Comma (,)</option>
                                <option value=";">Semicolon (;)</option>
                                <option value="	">Tab (\t)</option>
                            </select>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="headerRow" checked class="rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300">
                            <label for="headerRow" class="ml-2 text-sm text-slate-600">First row is header</label>
                        </div>
                        
                        <div class="flex items-center">
                            <input type="checkbox" id="parseNumbers" checked class="rounded text-blue-600 focus:ring-blue-500 h-4 w-4 border-gray-300">
                            <label for="parseNumbers" class="ml-2 text-sm text-slate-600">Parse numbers (e.g. "123" → 123)</label>
                        </div>
                    </div>
                </div>

                <!-- Status Message -->
                <div id="statusMsg" class="hidden p-3 rounded-lg text-sm flex items-center gap-2"></div>
            </div>

            <!-- Right Side: Output -->
            <div class="w-full lg:w-3/5 p-6 flex flex-col h-[700px] lg:h-auto bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-bold text-slate-700">JSON Output</h2>
                    <div class="flex gap-2">
                        <button id="btnCopy" onclick="copyToClipboard()" disabled class="px-3 py-1.5 text-xs font-semibold rounded-md border border-slate-200 text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                            <i class="fa-regular fa-copy mr-1"></i> Copy
                        </button>
                        <button id="btnDownload" onclick="downloadJSON()" disabled class="px-3 py-1.5 text-xs font-semibold rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm">
                            <i class="fa-solid fa-download mr-1"></i> Download
                        </button>
                    </div>
                </div>

                <div class="relative flex-grow border border-slate-200 rounded-xl bg-slate-50 overflow-hidden group">
                    <!-- Empty State -->
                    <div id="emptyState" class="absolute inset-0 flex flex-col items-center justify-center text-slate-400">
                        <i class="fa-solid fa-code text-4xl mb-3 opacity-20"></i>
                        <p class="text-sm">Upload a CSV to generate JSON</p>
                    </div>

                    <!-- Editor/Preview Area -->
                    <pre id="jsonOutput" class="w-full h-full p-4 overflow-auto code-font text-sm text-slate-800 leading-relaxed hidden"></pre>
                </div>
                
                <div class="mt-3 flex justify-between text-xs text-slate-400">
                    <span id="recordCount">0 records found</span>
                    <span id="fileSize">0 KB</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('fileInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const emptyState = document.getElementById('emptyState');
        const statusMsg = document.getElementById('statusMsg');
        const btnCopy = document.getElementById('btnCopy');
        const btnDownload = document.getElementById('btnDownload');
        const recordCount = document.getElementById('recordCount');
        const fileSize = document.getElementById('fileSize');
        
        // Translation Elements
        const translationPanel = document.getElementById('translationPanel');
        const transColumnSelect = document.getElementById('transColumn');
        const transModeSelect = document.getElementById('transMode');

        // Progress Elements
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressLabel = document.getElementById('progressLabel');
        const progressPercent = document.getElementById('progressPercent');
        
        // Options
        const optDelimiter = document.getElementById('delimiter');
        const optHeader = document.getElementById('headerRow');
        const optParseNums = document.getElementById('parseNumbers');

        let currentData = null;
        let originalFileName = 'data';

        // --- Data Dictionaries for Translation ---
        const banglaDigits = { '0': '০', '1': '১', '2': '২', '3': '৩', '4': '৪', '5': '৫', '6': '৬', '7': '৭', '8': '৮', '9': '৯' };
        
        const banglaMonths = {
            'january': 'জানুয়ারি', 'jan': 'জানু',
            'february': 'ফেব্রুয়ারি', 'feb': 'ফেব্রু',
            'march': 'মার্চ', 'mar': 'মার্চ',
            'april': 'এপ্রিল', 'apr': 'এপ্রিল',
            'may': 'মে',
            'june': 'জুন', 'jun': 'জুন',
            'july': 'জুলাই', 'jul': 'জুলাই',
            'august': 'আগস্ট', 'aug': 'আগস্ট',
            'september': 'সেপ্টেম্বর', 'sep': 'সেপ্টে',
            'october': 'অক্টোবর', 'oct': 'অক্টো',
            'november': 'নভেম্বর', 'nov': 'নভে',
            'december': 'ডিসেম্বর', 'dec': 'ডিসে'
        };

        const banglaDays = {
            'saturday': 'শনিবার', 'sat': 'শনি',
            'sunday': 'রবিবার', 'sun': 'রবি',
            'monday': 'সোমবার', 'mon': 'সোম',
            'tuesday': 'মঙ্গলবার', 'tue': 'মঙ্গল',
            'wednesday': 'বুধবার', 'wed': 'বুধ',
            'thursday': 'বৃহস্পতিবার', 'thu': 'বৃহস্পতি',
            'friday': 'শুক্রবার', 'fri': 'শুক্র'
        };

        // Event Listeners for File Input
        fileInput.addEventListener('change', handleFileSelect);
        
        // Event Listeners for Drag & Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-active');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-active');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-active');
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelect();
            }
        });

        // Re-process on option change if data exists
        [optDelimiter, optHeader, optParseNums].forEach(opt => {
            opt.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                    readFile(fileInput.files[0]);
                }
            });
        });

        function handleFileSelect() {
            const file = fileInput.files[0];
            if (file) {
                if (file.type && file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                    handleError('Please upload a valid CSV file.');
                    return;
                }
                originalFileName = file.name.replace('.csv', '');
                fileSize.textContent = (file.size / 1024).toFixed(2) + ' KB';
                readFile(file);
            }
        }

        function readFile(file) {
            // Reset UI
            currentData = null;
            jsonOutput.classList.add('hidden');
            emptyState.classList.remove('hidden');
            statusMsg.classList.add('hidden');
            translationPanel.classList.add('hidden'); // Hide translation panel until load complete
            
            showProgress(true);
            updateProgress(0, 'Starting...');

            const reader = new FileReader();
            
            reader.onprogress = function(e) {
                if (e.lengthComputable) {
                    const percent = Math.round((e.loaded / e.total) * 40);
                    updateProgress(percent, 'Reading file...');
                }
            };

            reader.onload = function(e) {
                updateProgress(40, 'File loaded. Parsing...');
                setTimeout(() => {
                    const text = e.target.result;
                    let step = 40;
                    const interval = setInterval(() => {
                        step += 10;
                        if (step >= 80) {
                            clearInterval(interval);
                            setTimeout(() => performParsing(text), 10);
                        } else {
                            updateProgress(step, 'Analyzing structure...');
                        }
                    }, 30);
                }, 100);
            };
            
            reader.onerror = function() {
                handleError('Error reading file.');
            };

            reader.readAsText(file);
        }

        function performParsing(text) {
            try {
                updateProgress(90, 'Generating JSON...');
                setTimeout(() => {
                    const delimiter = detectDelimiter(text);
                    const json = parseCSV(text, delimiter);
                    currentData = json;
                    
                    updateProgress(100, 'Complete!');
                    setTimeout(() => {
                        displayJSON(json);
                        populateTranslationColumns(json); // Setup translation tool
                        showStatus('success', 'Conversion successful!');
                        
                        btnCopy.disabled = false;
                        btnDownload.disabled = false;
                        recordCount.textContent = `${json.length} records generated`;
                        
                        setTimeout(() => showProgress(false), 800);
                    }, 500);
                }, 50);

            } catch (err) {
                console.error(err);
                handleError('Error parsing CSV. Check format.');
            }
        }

        // --- Translation Logic ---

        function populateTranslationColumns(data) {
            if (!data || data.length === 0 || typeof data[0] !== 'object') {
                translationPanel.classList.add('hidden');
                return;
            }

            // Only show if we have an array of objects (header mode)
            if (Array.isArray(data[0])) {
                 translationPanel.classList.add('hidden');
                 return;
            }

            translationPanel.classList.remove('hidden');
            transColumnSelect.innerHTML = '<option value="" disabled selected>Select a column</option>';
            
            const keys = Object.keys(data[0]);
            keys.forEach(key => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = key;
                transColumnSelect.appendChild(option);
            });
        }

        function applyTranslation() {
            if (!currentData) return;
            const column = transColumnSelect.value;
            const mode = transModeSelect.value;

            if (!column) {
                showStatus('error', 'Please select a column to translate.');
                return;
            }

            showProgress(true);
            updateProgress(0, 'Translating...');

            setTimeout(() => {
                let modifiedCount = 0;
                
                currentData = currentData.map(row => {
                    if (row[column] !== null && row[column] !== undefined) {
                        const originalVal = String(row[column]);
                        let newVal = originalVal;

                        if (mode === 'number') {
                            newVal = convertToBanglaNumber(originalVal);
                        } else if (mode === 'date') {
                            newVal = convertToBanglaDate(originalVal);
                        } else if (mode === 'names') {
                            newVal = convertNames(originalVal);
                        }

                        if (newVal !== originalVal) modifiedCount++;
                        return { ...row, [column]: newVal };
                    }
                    return row;
                });

                displayJSON(currentData);
                updateProgress(100, 'Done!');
                
                setTimeout(() => {
                    showProgress(false);
                    showStatus('success', `Translated ${modifiedCount} rows in '${column}'.`);
                }, 800);
            }, 100);
        }

        function convertToBanglaNumber(str) {
            return str.replace(/[0-9]/g, match => banglaDigits[match]);
        }

        function convertNames(str) {
            let lower = str.toLowerCase();
            // Check days
            for (let [eng, bn] of Object.entries(banglaDays)) {
                if (lower.includes(eng)) {
                    str = str.replace(new RegExp(eng, 'gi'), bn);
                }
            }
            // Check months
            for (let [eng, bn] of Object.entries(banglaMonths)) {
                if (lower.includes(eng)) {
                    str = str.replace(new RegExp(eng, 'gi'), bn);
                }
            }
            return str;
        }

        function convertToBanglaDate(str) {
            // 1. Convert Month Names and Days first
            let result = convertNames(str);
            
            // 2. Convert all remaining numbers
            result = convertToBanglaNumber(result);
            
            return result;
        }

        // --- Standard Logic ---

        function handleError(msg) {
            showStatus('error', msg);
            showProgress(false);
        }

        function updateProgress(percent, label) {
            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            if (label) progressLabel.textContent = label;
        }

        function showProgress(show) {
            if (show) {
                progressContainer.classList.remove('hidden');
            } else {
                progressContainer.classList.add('hidden');
                setTimeout(() => { progressBar.style.width = '0%'; }, 300);
            }
        }

        function detectDelimiter(text) {
            const userSelection = optDelimiter.value;
            if (userSelection !== 'auto') return userSelection;
            const firstLine = text.split('\n')[0];
            const commas = (firstLine.match(/,/g) || []).length;
            const semi = (firstLine.match(/;/g) || []).length;
            const tabs = (firstLine.match(/\t/g) || []).length;
            if (tabs > commas && tabs > semi) return '\t';
            if (semi > commas) return ';';
            return ',';
        }

        function parseCSV(text, delimiter) {
            text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const pattern = new RegExp(
                ("(\\" + delimiter + "|\\r?\\n|\\r|^)" +
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                "([^\"\\" + delimiter + "\\r\\n]*))"), "gi"
            );
            const rows = [[]];
            let matches = null;
            while (matches = pattern.exec(text)) {
                const matchedDelimiter = matches[1];
                if (matchedDelimiter.length && matchedDelimiter !== delimiter) { rows.push([]); }
                let matchedValue;
                if (matches[2]) { matchedValue = matches[2].replace(new RegExp("\"\"", "g"), "\""); }
                else { matchedValue = matches[3]; }
                rows[rows.length - 1].push(matchedValue);
            }
            if(rows.length > 0 && (rows[rows.length-1].length === 0 || (rows[rows.length-1].length === 1 && rows[rows.length-1][0] === undefined))) {
                 rows.pop();
            }
            if (optHeader.checked && rows.length > 0) {
                const headers = rows[0];
                const data = [];
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.length === 1 && !row[0]) continue;
                    const obj = {};
                    let hasData = false;
                    headers.forEach((header, index) => {
                        let val = row[index];
                        if(optParseNums.checked && val !== "" && !isNaN(val)) { val = Number(val); }
                        const key = header ? header.trim() : `field_${index}`;
                        obj[key] = val !== undefined ? val : null;
                        if (val !== undefined && val !== "") hasData = true;
                    });
                    if (hasData) data.push(obj);
                }
                return data;
            } else { return rows; }
        }

        function displayJSON(data) {
            emptyState.classList.add('hidden');
            jsonOutput.classList.remove('hidden');
            jsonOutput.textContent = JSON.stringify(data, null, 2);
        }

        function showStatus(type, msg) {
            statusMsg.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            if (type === 'error') {
                statusMsg.classList.add('bg-red-100', 'text-red-700');
                statusMsg.innerHTML = `<i class="fa-solid fa-circle-exclamation"></i> ${msg}`;
            } else {
                statusMsg.classList.add('bg-green-100', 'text-green-700');
                statusMsg.innerHTML = `<i class="fa-solid fa-circle-check"></i> ${msg}`;
            }
        }

        function copyToClipboard() {
            if (!jsonOutput.textContent) return;
            const textarea = document.createElement('textarea');
            textarea.value = jsonOutput.textContent;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            const originalText = btnCopy.innerHTML;
            btnCopy.innerHTML = `<i class="fa-solid fa-check mr-1"></i> Copied`;
            setTimeout(() => { btnCopy.innerHTML = originalText; }, 2000);
        }

        function downloadJSON() {
            if (!currentData) return;
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(currentData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", originalFileName + ".json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function resetApp() {
            fileInput.value = '';
            jsonOutput.textContent = '';
            jsonOutput.classList.add('hidden');
            emptyState.classList.remove('hidden');
            statusMsg.classList.add('hidden');
            translationPanel.classList.add('hidden');
            btnCopy.disabled = true;
            btnDownload.disabled = true;
            recordCount.textContent = '0 records found';
            fileSize.textContent = '0 KB';
            currentData = null;
            showProgress(false);
        }
    </script>
</body>
</html>